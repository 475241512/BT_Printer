#include "hw_platform.h"
#ifdef LCD_VER
#include "Lcd.h"
#include "TimeBase.h"
#include "AsciiLib_6x12.h"

extern unsigned char const fontb_en[];

static unsigned char Lcd_RAM[6][64];		//显示缓存，每个Bit对应一个点，单色显示，1：表示改点显示黑色， 0：表示该点显示白色。
static unsigned char Lcd_RAM_x;
static unsigned char Lcd_RAM_y;
static unsigned char g_font;

unsigned char	lcd_refresh_disable;
unsigned char	need_update_bt_info_flag;

#define RST_LOW()		do{\
	GPIOA->BRR = GPIO_Pin_8;\
	}while(0)

#define RST_HIGH()		do{\
	GPIOA->BSRR = GPIO_Pin_8;\
	}while(0)

#define CS_LOW()		do{\
	GPIOC->BRR = GPIO_Pin_9;\
	}while(0)

#define CS_HIGH()		do{\
	GPIOC->BSRR = GPIO_Pin_9;\
	}while(0)

#define A0_LOW()		do{\
	GPIOC->BRR = GPIO_Pin_8;\
	}while(0)

#define A0_HIGH()		do{\
	GPIOC->BSRR = GPIO_Pin_8;\
	}while(0)

#define SCK_LOW()		do{\
	GPIOC->BRR = GPIO_Pin_7;\
	}while(0)

#define SCK_HIGH()		do{\
	GPIOC->BSRR = GPIO_Pin_7;\
	}while(0)

#define SDA_LOW()		do{\
	GPIOC->BRR = GPIO_Pin_6;\
	}while(0)

#define SDA_HIGH()		do{\
	GPIOC->BSRR = GPIO_Pin_6;\
	}while(0)

//初始化LCD的IO
static void Lcd_port_init(void)
{
	GPIO_InitTypeDef							GPIO_InitStructure;
	//LED_BLUE	-- PB.12
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA| RCC_APB2Periph_GPIOB | RCC_APB2Periph_GPIOC, ENABLE);

	//LCD_DATA -- PC.6  LCD_SCK -- PC.7  LCD_C/D -- PC.8  LCD_CS -- PC.9
	GPIO_InitStructure.GPIO_Pin				= GPIO_Pin_6 | GPIO_Pin_7 | GPIO_Pin_8 | GPIO_Pin_9;
	GPIO_InitStructure.GPIO_Mode			= GPIO_Mode_Out_PP;
	GPIO_InitStructure.GPIO_Speed			= GPIO_Speed_50MHz;
	GPIO_Init(GPIOC, &GPIO_InitStructure);

	//LCD_Reset -- PA.8
	GPIO_InitStructure.GPIO_Pin				= GPIO_Pin_8;
	GPIO_InitStructure.GPIO_Mode			= GPIO_Mode_Out_PP;
	GPIO_InitStructure.GPIO_Speed			= GPIO_Speed_10MHz;
	GPIO_Init(GPIOA, &GPIO_InitStructure);

	//LCD_BACKLight -- PB.12
	GPIO_InitStructure.GPIO_Pin				= GPIO_Pin_12;
	GPIO_InitStructure.GPIO_Mode			= GPIO_Mode_Out_PP;
	GPIO_InitStructure.GPIO_Speed			= GPIO_Speed_10MHz;
	GPIO_Init(GPIOB, &GPIO_InitStructure);
}

//量测V0对地电压为6.4~6.5V
 /*第二套对比度方案
     write(0x23,0);
    write(0x81,0);  //Electronic Volume Mode Set
     write(0x13,0);  //Electronic Volume Register Set (改变此值可调节对比度，调节范围0x00~0x3F）
 */
void write(unsigned char data,unsigned char A0)
{
	int i;
	CS_LOW();
	if (A0)
	{
		A0_HIGH();
	}
	else
	{
		A0_LOW();
	}
	for (i = 0; i < 8;i ++)
	{
		if (data&0x80)
		{
			SDA_HIGH();
		}
		else
		{
			SDA_LOW();
		}

		SCK_LOW();

		data<<=1;
		SCK_HIGH();
	}
	CS_HIGH();
}

void write_ext(unsigned char data,unsigned char A0)
{
	int i;
	CS_LOW();
	A0_HIGH();
	for (i = 0; i < 8;i ++)
	{
		if (data&0x80)
		{
			//SDA_HIGH();
			SDA_LOW();
		}
		else
		{
			SDA_HIGH();
		}

		SCK_LOW();

		data<<=1;
		SCK_HIGH();
	}
	CS_HIGH();
}


void Lcd_init(void) //write函数，第二参数0表示指令，1表示数据
{
	Lcd_port_init();
	LCD_BACKLIGHT_ON();

	RST_LOW();
	delay_us(20);  //20us
	RST_HIGH();
	delay_us(200);  //200us

	write(0xe2,0);  //Reset
	delay_us(200);   //200us

	write(0xA3,0);  //set 1/6 bias
	write(0xA0,0);  //seg0~seg131
	write(0xc8,0);  //com63~com0

	write(0xa4,0);  //display normal
	write(0x40,0);  //display start line set

	write(0xf8,0);    //booster
	write(0x00,0);    //5xVDD

	// write(0x22,0);  //set (1+Rb/Ra) 100:5.0 ; 111: 6.4
	write(0x23,0);
	// delay(20);  //2ms
	write(0x81,0);  //Electronic Volume Mode Set
	// write(0x19,0);  //Electronic Volume Register Set (改变此值可调节对比度，调节范围0x00~0x3F）
	write(0x13,0);
	// delay(10);   //1ms

	write(0x2c,0);  //power control set
	delay_us(100);   //100us
	write(0x2e,0);  //power control set
	delay_us(100);   //100us
	write(0x2F,0);  //power control set
	delay_us(100);   //100us

	//   delay(50);   //50us
	write(0xaf,0); //Dispaly On
	delay_us(50);   //50us

	Lcd_clear(1);
	Lcd_setfont(FONT_12x6);
	need_update_bt_info_flag = 1;
}
#if 0
unsigned char const AA[]= {
	/*--  调入了一幅图像：D:\My Documents\程序调试\zimo\128x64_da.bmp  --*/
	/*--  宽度x高度=128x64  --*/
	0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,
	0x60,0xF8,0xFE,0x06,0x00,0x00,0x80,0xFE,0xFE,0x40,0x60,0x30,0x18,0x18,0x88,0x80,
	0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF0,0x3C,0x3E,0x26,0x20,0xA0,0xA0,0x20,0x20,
	0x20,0xA0,0xE0,0x70,0x30,0x20,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x18,0xF8,
	0xF8,0x0C,0x04,0x04,0x04,0x00,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,
	0xF0,0xF0,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xE0,0x30,0x10,
	0x10,0x10,0x30,0xF0,0xF0,0x00,0x00,0x10,0xF0,0xF0,0x10,0x10,0x10,0x30,0xE0,0xC0,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x41,0x40,
	0x40,0x4F,0x4F,0x40,0x41,0x41,0xF9,0xFF,0x47,0x44,0x44,0x44,0x44,0x44,0x67,0x67,
	0x44,0x00,0x00,0x00,0x00,0x01,0xC1,0xF0,0x3C,0x1C,0x0C,0x00,0xFF,0xFF,0x00,0x04,
	0x0C,0x18,0x70,0xE0,0xC0,0x80,0x00,0x00,0x00,0x02,0x02,0x02,0x02,0x02,0xC2,0xFF,
	0x3F,0x02,0x02,0x02,0x02,0x02,0xFF,0xFF,0x02,0x02,0x03,0x03,0x02,0x00,0x00,0x00,
	0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x7F,0xFF,0x80,0x00,0x00,
	0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0xC0,0xFF,
	0x3F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x02,0x03,0x01,0x00,0x00,0x00,0x04,0x04,0x0F,0x0F,0x00,0x00,
	0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x08,0x08,0x0C,0x06,0x03,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,
	0x03,0x03,0x02,0x02,0x02,0x02,0x03,0x03,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x02,
	0x02,0x02,0x03,0x01,0x00,0x00,0x00,0x02,0x03,0x03,0x02,0x02,0x02,0x03,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,
	0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x00,0x00,0x00,0x80,
	0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x80,0xC0,0xC0,0x00,0x00,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x80,0x00,
	0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,0x00,0x00,0xC0,0xC0,
	0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x80,0xC0,0xC0,0xC0,0xC0,
	0xC0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x03,0xFF,0xFF,
	0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x80,0xC0,0x60,0x31,0x1F,0x0F,0x00,0xC7,0xEF,
	0x39,0x18,0x10,0x30,0x79,0xEF,0xC7,0x00,0x04,0x1C,0x38,0xF0,0xF0,0x38,0x1C,0x04,
	0x00,0xFC,0xFF,0x13,0x19,0x18,0x18,0x38,0xF0,0xE0,0x00,0x70,0x78,0x6C,0x66,0x63,
	0x61,0xFF,0xFF,0x60,0x60,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0xFF,
	0xFC,0x00,0xFC,0xFF,0x03,0x01,0x00,0x00,0x00,0x00,0x01,0x03,0xFF,0xFC,0x00,0x00,
	0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,0x19,0x30,0x30,0x30,
	0x30,0x60,0xE1,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x0C,0x0F,0x0F,
	0x0C,0x0C,0x0C,0x00,0x00,0x0E,0x0F,0x0D,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x03,0x07,
	0x0E,0x0C,0x0C,0x0C,0x0E,0x07,0x03,0x00,0x08,0x0E,0x07,0x03,0x03,0x07,0x0E,0x08,
	0x00,0x01,0x07,0x0E,0x0C,0x0C,0x0C,0x0E,0x07,0x03,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x0F,0x0F,0x00,0x00,0x00,0x0F,0x0F,0x0C,0x0C,0x0C,0x0C,0x0E,0x06,0x07,0x03,
	0x00,0x00,0x00,0x03,0x07,0x0E,0x0C,0x0C,0x0C,0x0C,0x0E,0x07,0x03,0x00,0x00,0x00,
	0x00,0x00,0x00,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x06,0x0C,0x0C,0x0C,0x0C,0x0C,
	0x0C,0x06,0x07,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
	0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF,
};

void DispBmp1(void)//normal
{
	int i=0;
	unsigned char cnt, cnt1;
	write(0x40,0);      // Set Display Start Line
	unsigned char AA[64*6];

	memset((void*)AA,0xFF,64*6);

	for(cnt = 0; cnt < 6; cnt ++)
	{
		write(0xb0 + cnt,0);
		write(0x10,0);
		write(0x00,0);

		for(cnt1 = 0; cnt1 < 64; cnt1 ++)
		{
			write(AA[i],1);
			i++;
		}
		//delay(100);

	}
	//delay(800);
}
#endif
//c: 0 -- balck   else: white
void Lcd_clear(unsigned char c)
{
	int i=0;
	unsigned char cnt, cnt1,tmp;
	write(0x40,0);      // Set Display Start Line

	tmp = (c==0)?0x00:0xff;
	memset(Lcd_RAM,tmp,64*6);
	for(cnt = 0; cnt < 6; cnt ++)
	{
		write(0xb0 + cnt,0);
		write(0x10,0);
		write(0x00,0);

		for(cnt1 = 0; cnt1 < 64; cnt1 ++)
		{
			write(tmp,1);
			i++;
		}
		//delay(100);

	}
	//delay(800);
}


unsigned char const logo_bmp[]= {
//E:\BT_Printer\resource\logo_zheng.bmp(0)

  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0xC0,0xC0,0xC0,0x00,0x00,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x80,
  0x00,0x00,0x80,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x80,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x0C,0x0C,0x0C,0xFF,0xFF,0xFF,0x00,0x3F,0x7F,0x7F,0xCC,0xCC,0xCC,0xCC,0xCC,0x00,0xFF,0xFF,0xFF,0x18,0x18,0x7C,0xFF,0xCF,
  0x00,0x3F,0x7F,0x7F,0xE0,0xC0,0xC0,0xF1,0x7F,0x3F,0x0C,0xC0,0xC0,0xC0,0xC0,0xE0,0x7F,0x7F,0x3F,0x00,0x1E,0x7F,0x7F,0xEC,0xCC,0xCC,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0x30,0x30,0x30,0xFE,0xFE,0x00,0x80,0x80,0xFE,0xFE,0x00,0x00,0xBE,0xBE,0xB6,0xF6,0xE6,
  0x00,0xEC,0xFE,0x32,0x32,0xFE,0xEC,0x00,0x00,0xFE,0xFE,0xB6,0xB6,0xFE,0xEC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x00,
  0x00,0x00,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  /*"E:\BT_Printer\resource\logo_zheng.bmp",0*/
};

unsigned char const nopaper_bmp[]=
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xC0,0xC0,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xC0,0xC0,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x6F,0x6F,0x63,0xFF,0xFF,0x63,0x63,0x63,0x86,0x86,0xF6,0xFF,0xFF,0x86,0xFE,0xFE,0xFE,0x00,0x10,0x3C,
	0xBF,0xF7,0xF1,0x3E,0x0E,0xFF,0xFF,0xFF,0x61,0x61,0xFF,0xFF,0xFF,0x60,0x60,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0xC0,0xFF,0xFF,0xC0,0xFE,0xFE,0xE1,0x71,0x3F,0x0F,0x1F,0x7D,0xF1,0xE1,0xC1,0x00,0x40,0xCE,
	0xCF,0x6F,0x6E,0x66,0x66,0xFF,0xFF,0xFF,0xC0,0xE0,0x00,0x3F,0xFF,0xF0,0xE0,0xF8,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	/*"E:\BT_Printer\resource\缺纸.bmp",0*/
};

unsigned char const fail_bmp[]=
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0xE0,0x00,0x00,0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,
	0xC0,0x40,0x40,0x40,0xC0,0x00,0x80,0xE0,0xE0,0xA0,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x24,0x2F,0x23,0x21,0x21,0xE1,0xFF,0xFF,0xE1,0xA1,0x21,0x21,0x21,0x21,0x20,0x00,0xFF,
	0xFF,0xFE,0xFE,0x00,0xFF,0x06,0x07,0x3F,0xF8,0xC0,0xF8,0x3F,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x0C,0x06,0x07,0x01,0x00,0x00,0x01,0x03,0x06,0x0C,0x08,0x00,0x00,0x00,0x08,
	0x0C,0x07,0x03,0x07,0x0E,0x0C,0x0C,0x0E,0x07,0x03,0x07,0x0E,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	/*"E:\BT_Printer\resource\Fail.bmp",0*/
};

unsigned char const ok_bmp[]=
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xF0,0xF0,0x80,0x80,0xF0,0xF0,0x80,0x20,0x20,
	0xE0,0xE0,0xE0,0x20,0x00,0x00,0xF0,0xF0,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xFF,0x3F,0x04,0x04,0xFC,0xFC,0x00,0x7F,0xFF,0xE0,0x78,0x1F,0x87,0x00,0x00,0x00,
	0xFF,0xFF,0xFF,0x40,0x40,0xC1,0xFF,0x7F,0x01,0x01,0x01,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x07,0x07,0x00,0x01,0x01,0x01,0x0C,0x0E,0x07,0x03,0x07,0x0C,0x0C,0x0F,0x03,0x01,0x01,
	0x00,0x00,0x00,0x06,0x0F,0x07,0x01,0x00,0x08,0x08,0x08,0x0F,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	/*"E:\BT_Printer\resource\OK.bmp",0*/
};


unsigned char const pin_reset_bmp[]=
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x80,
	0x80,0x80,0x80,0x80,0x80,0x80,0x40,0x40,0x40,0x40,0x00,0x00,0xC0,0xC0,0x40,0xC0,0xC0,0x40,0xC0,0xC0,0x40,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x31,0x31,0x31,0x31,0x1F,0x0F,0x81,0xFF,0xFF,0x81,0x00,0xFF,0xFF,0x07,0x0E,0x3C,0x70,0xE0,0xFF,0xFF,0x00,0x02,0xBE,
	0xBE,0xAA,0xAA,0xAA,0xFF,0xAA,0xAA,0xAA,0xBE,0xBE,0x02,0x08,0x0B,0xFB,0xAA,0xAB,0xAF,0xAE,0xAB,0xAB,0xAA,0xFB,0x0B,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x00,0x02,0x02,
	0x02,0x02,0x02,0x02,0x03,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x03,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x03,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	/*"E:\BT_Printer\resource\pin_reset.bmp",0*/
};

unsigned char const sys_err_bmp[]=
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x04,0x34,0xB4,0xBC,0xFC,0x6C,0x64,0x24,0x24,0x76,0xDA,0x92,0x02,0x00,0x40,0x70,0xFC,0xCE,0x70,0x28,0xC8,0xF8,0x3E,0x1E,0x0C,0xC8,0xC8,0x88,0x00,0x20,
	0x3C,0xEE,0xEA,0x28,0x00,0x48,0x7E,0x7E,0x48,0x48,0x7E,0x7E,0x48,0x40,0x20,0xE4,0xEE,0x04,0x00,0x5E,0x5E,0x52,0x52,0xD2,0x52,0x52,0x5E,0x5E,0x00,0x00,0x00,0x00,
	0x00,0x00,0x31,0x19,0x1D,0x29,0x21,0x21,0x3F,0x1F,0x01,0x09,0x19,0x11,0x37,0x00,0x20,0x2E,0x27,0x15,0x14,0x31,0x39,0x1F,0x07,0x01,0x3F,0x3F,0x21,0x39,0x10,0x01,
	0x01,0x3F,0x1F,0x09,0x09,0x3F,0x3F,0x15,0x15,0x15,0x15,0x3F,0x3F,0x00,0x00,0x1F,0x3F,0x08,0x20,0x22,0x12,0x1A,0x0E,0x07,0x0E,0x1A,0x12,0x22,0x02,0x00,0x00,0x00,
	/*"E:\BT_Printer\resource\sys_err.bmp",0*/
};


static unsigned char const* pic_id_to_addr(unsigned char pic_id)
{
	switch(pic_id)
	{
	case PIC_POWERON:
		return logo_bmp;
	case PIC_NOPAPER:
		return nopaper_bmp;
	case PIC_SYS_ERR:
		return sys_err_bmp;
	case PIC_PIN_RESET:
		return pin_reset_bmp;
	case PIC_OK:
		return ok_bmp;
	case PIC_FAIL:
		return fail_bmp;
	default:
		return (unsigned char const*)0;
	}
}

void Lcd_dispBMP(unsigned char pic_id)//normal
{
	int i=0;
	unsigned char cnt, cnt1;
	unsigned char const *p;
	p = pic_id_to_addr(pic_id);
	if (p == 0)
	{
		return;
	}
	write(0x40,0);      // Set Display Start Line
	for(cnt = 0; cnt < 6; cnt ++)
	{
		write(0xb0 + cnt,0);
		write(0x10,0);
		write(0x00,0);
		for(cnt1 = 0; cnt1 < 64; cnt1 ++)
		{
			//write(AA[cnt-1][cnt1],1);
			write_ext(p[i],1);	//反显
			i++;
		}
	}
}

void Lcd_dispBMP_ext(unsigned char pic_id1,unsigned char pic_id2)//normal
{
	int i=0;
	unsigned char cnt, cnt1;
	unsigned char const *p1,*p2;
	p1 = pic_id_to_addr(pic_id1);
	if (p1 == 0)
	{
		return;
	}
	p2 = pic_id_to_addr(pic_id2);
	if (p2 == 0)
	{
		return;
	}

	write(0x40,0);      // Set Display Start Line
	for(cnt = 0; cnt < 6; cnt ++)
	{
		if (cnt%3 == 0)
		{
			i = 0;
		}
		write(0xb0 + cnt,0);
		write(0x10,0);
		write(0x00,0);
		for(cnt1 = 0; cnt1 < 64; cnt1 ++)
		{
			//write(AA[cnt-1][cnt1],1);
			if (cnt>2)
			{
				write_ext(p2[i],1);	//反显
			}
			else
			{
				write_ext(p1[i],1);	//反显
			}
			i++;
		}
	}
}


void set_cursor(unsigned char x,unsigned char y)
{
	Lcd_RAM_x = x;
	Lcd_RAM_y = y/8;
	write(0xb0+(y/8),0);//set page address
	write(0x10+x/16,0);//Set Higer Column Address
	write(x%16,0); //Set Lower Column Address
}


/**
* @brief     在指定座标画点
* @author joe
* @param[in] unsigned short x         列座标
* @param[in] unsigned short y         行座标
* @param[in] unsigned char  color      颜色   1：黑色   0：白色
* @param[out]  none
* @return  none
* @note  
*     调用方法：Lcd_SetPoint(10,10,1);
*/
inline void Lcd_SetPoint(unsigned short x,unsigned short y,unsigned short color)
{
	unsigned char offset;

	if ((x>=64)||(y>=48))
	{
		return;
	}
	set_cursor(x,y);
	offset = y%8;		//要操作的点位于该字节的第几个bit
	if(color)
	{
		Lcd_RAM[Lcd_RAM_y][Lcd_RAM_x] |= (0x01 << offset);
	}
	else
	{
		Lcd_RAM[Lcd_RAM_y][Lcd_RAM_x] &= ~(0x01 << offset);
	}

	write(Lcd_RAM[Lcd_RAM_y][Lcd_RAM_x],1);
}

//只是改变显存里面的值
inline void Lcd_SetRAMPoint(unsigned short x,unsigned short y,unsigned short color)
{
	unsigned char offset;

	if ((x>=64)||(y>=48))
	{
		return;
	}
	set_cursor(x,y);
	offset = y%8;		//要操作的点位于该字节的第几个bit
	if(color)
	{
		Lcd_RAM[Lcd_RAM_y][Lcd_RAM_x] |= (0x01 << offset);
	}
	else
	{
		Lcd_RAM[Lcd_RAM_y][Lcd_RAM_x] &= ~(0x01 << offset);
	}
}

/**
* @brief 往lcd输出一小行字模
*/
void Lcd_PutCharLine(unsigned short x, unsigned short y, unsigned char d, unsigned short charColor) 
{
	int				i;

	if (charColor)
	{
		for(i=0; i<8; i++)
		{
			if(d & 0x80)
				Lcd_SetPoint(x, y++, 1);		// 字符颜色
			else
				Lcd_SetPoint(x, y++, 0);
			d <<= 1;
		}
	}
	else
	{
		for(i=0; i<8; i++)
		{
			if(d & 0x80)
				Lcd_SetPoint(x, y++, 0);		// 字符颜色
			else
				Lcd_SetPoint(x, y++, 1);
			d <<= 1;
		}
	}

}

/**
* @brief 往lcd输出一小行字模
*/
void Lcd_PutCharLine_ext(unsigned short x, unsigned short y, unsigned char d, unsigned short charColor) 
{
	int				i;

	if (charColor)
	{
		for(i=0; i<8; i++)
		{
			if(d & 0x80)
				Lcd_SetPoint(x++, y, 1);		// 字符颜色
			else
				Lcd_SetPoint(x++, y, 0);
			d <<= 1;
		}
	}
	else
	{
		for(i=0; i<8; i++)
		{
			if(d & 0x80)
				Lcd_SetPoint(x++, y, 0);		// 字符颜色
			else
				Lcd_SetPoint(x++, y, 1);
			d <<= 1;
		}
	}

}
/**
* @brief 画水平线
* @note x:被归一为4的倍数	w:被归一为4的倍数
*/
void Lcd_DrawLineH(int x, int y, int w,unsigned short color)
{

	unsigned char width;
	unsigned char i;
	width = 64 - x;
	if (width < w)
	{
		w = width;
	}

	for(i = 0; i < w;i++)
	{
		if (color == 0)
		{
			Lcd_SetPoint(x+i,y,0);
		}
		else
		{
			Lcd_SetPoint(x+i,y,1);
		}
	}
}

/**
* @brief 画垂直线
*/
void Lcd_DrawLineV(int x, int y, int h,unsigned short color)
{
	unsigned char height;
	unsigned char i;
	height = 48 - y;
	if (height < h)
	{
		h = height;
	}

	for(i = 0; i < h;i++)
	{
		if (color == 0)
		{
			Lcd_SetPoint(x,y+i,0);
		}
		else
		{
			Lcd_SetPoint(x,y+i,1);
		}
	}
}

/**
* @brief 输出一个英文字符
*/
static void Lcd_PutChar16_8(unsigned char x,unsigned char y,unsigned char c)
{
	int								i;
	unsigned char		*pData;
	unsigned char		lcd_x, lcd_y;

	lcd_x							= x;
	lcd_y							= y;

	if (c >= 0x20)
	{
		pData			= (unsigned char *)(fontb_en + 16 * (c-0x20));	//在可见字符之前加了三个特殊字符
	}
	else
	{
		return;
	}

	for(i=0; i<8; i++, lcd_x++)
	{
		Lcd_PutCharLine(lcd_x, lcd_y, *pData++, 0);
		Lcd_PutCharLine(lcd_x, lcd_y+8, *pData++, 0);
	}
}

/**
* @brief 输出一个英文字符
*/
static void Lcd_PutChar12_6(unsigned char x,unsigned char y,unsigned char c)
{
	int								i;
	unsigned char		*pData;
	unsigned char		lcd_x, lcd_y;

	lcd_x							= x;
	lcd_y							= y;

	if (c >= 0x20)
	{
		pData			= (unsigned char *)(AsciiLib_6x12 + 12 * (c-0x20));	//在可见字符之前加了三个特殊字符
	}
	else
	{
		return;
	}

	for(i=0; i<12; i++, lcd_y++)
	{
		Lcd_PutCharLine_ext(lcd_x, lcd_y, *pData++, 0);
	}
}

void Lcd_setfont(unsigned char font_size)
{
	if (font_size == FONT_16x8 || font_size == FONT_12x6)
	{
		g_font = font_size;
	}
}

/**
* @brief 文字输出
*/
void Lcd_TextOut(int x, int y, unsigned char *pText)
{
	unsigned char					*pChar = pText;

	if (g_font == FONT_16x8)
	{
		if ((x>56)||(y>32))
		{
			return;
		}

		while(*pChar)
		{
			if( *pChar >= 0x20 && *pChar <= 0x80)
			{	// ASCII
				Lcd_PutChar16_8(x, y, *pChar);
				x		+= 8;
				if (x>56)
				{
					break;
				}
				pChar++;
			}
		}
	}
	else
	{
		if ((x>58)||(y>36))
		{
			return;
		}

		while(*pChar)
		{
			if( *pChar >= 0x20 && *pChar <= 0x80)
			{	// ASCII
				Lcd_PutChar12_6(x, y, *pChar);
				x		+= 6;
				if (x>58)
				{
					break;
				}
				pChar++;
			}
		}
	}
	
}


//LCD的背光闪烁
void Lcd_blink(unsigned int cnt,unsigned int period_ms)
{
	unsigned int i;
	for (i = 0; i < cnt;i++)
	{
		LCD_BACKLIGHT_ON();
		delay_ms(period_ms);
		LCD_BACKLIGHT_OFF();
		delay_ms(period_ms);
	}
}

static signed char lcd_flash_cnt;
#define LCD_SLOW_FLASH_SPEED    4
#define LCD_FAST_FLASH_SPEED    60
extern unsigned char BT_current_pin[][5];

void Lcd_disp_BT_info(void)
{
	unsigned char str[11];
	if (need_update_bt_info_flag == 0)
	{
		return;
	}

	//Lcd_TextOut(0,6,"Name PIN S");
#if(BT_MODULE_CONFIG & USE_BT1_MODULE)
	if (BT1_CONNECT)
	{
		sprintf(str,"HJ1_%s *",&BT_mac[BT1_MODULE][8]);
	}
	else
	{
		sprintf(str,"HJ1_%s  ",&BT_mac[BT1_MODULE][8]);
	}
	Lcd_TextOut(0,6,str);
#endif
	
#if(BT_MODULE_CONFIG & USE_BT2_MODULE)
	if (BT2_CONNECT)
	{
		sprintf(str,"HJ2_%s *",&BT_mac[BT2_MODULE][8]);
	}
	else
	{
		sprintf(str,"HJ2_%s  ",&BT_mac[BT2_MODULE][8]);
	}
	Lcd_TextOut(0,18,str);
#endif
	sprintf(str,"PIN:%s",BT_current_pin[BT1_MODULE]);
	Lcd_TextOut(0,30,str);
	need_update_bt_info_flag = 0;
	//Lcd_DrawLineH(0,18,64,0);
	//Lcd_DrawLineV(27,0,48,0);
	//Lcd_DrawLineH(0,31,64,0);
	//Lcd_DrawLineV(51,0,48,0);
	//Lcd_DrawLineH(0,45,64,0);
}

void Lcd_Refresh(void)
{
	if (lcd_refresh_disable)
	{
		return;
	}
	if(TPPrinterReady() == 0)	// 打印机未就绪
	{
		if(TPPaperReady() == 0 )//缺纸
		{
			Lcd_dispBMP(PIC_NOPAPER);
			need_update_bt_info_flag = 1;
			if(lcd_flash_cnt > 0)
			{
				if((--lcd_flash_cnt) == 0)
				{
					LCD_BACKLIGHT_OFF();
					lcd_flash_cnt = -LCD_FAST_FLASH_SPEED;
				}
			}
			else if(lcd_flash_cnt < 0)
			{
				if((++lcd_flash_cnt) == 0)
				{
					LCD_BACKLIGHT_ON();
					lcd_flash_cnt = LCD_FAST_FLASH_SPEED;
				}
			}
			else
			{
				LCD_BACKLIGHT_ON();
				lcd_flash_cnt = LCD_FAST_FLASH_SPEED;
			}
		}
		else
		{
			LCD_BACKLIGHT_ON();
			Lcd_disp_BT_info();
		}
	}
	else	// 打印机就绪
	{
		LCD_BACKLIGHT_ON();
		lcd_flash_cnt = 0;
		Lcd_disp_BT_info();
	}
}

#endif